[![Language](https://img.shields.io/badge/Language-Go-blue.svg)](https://golang.org/)
[![License](https://img.shields.io/badge/license-MIT-green)](https://opensource.org/licenses/MIT)

ä¸­æ–‡ | [English](README_en.md)

### æ¦‚è¿°

eraft é¡¹ç›®çš„æ˜¯å°† mit6.824 lab å¤§ä½œä¸šå·¥ä¸šåŒ–æˆä¸€ä¸ªåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œæˆ‘ä»¬ä¼šç”¨å…¨ç½‘æœ€ç®€å•ï¼Œç›´ç™½çš„è¯­è¨€ä»‹ç»åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸç†ï¼Œå¹¶å¸¦ç€ä½ è®¾è®¡å’Œå®ç°ä¸€ä¸ªå·¥ä¸šåŒ–çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€‚

### æœ€æ–°çš„æ–‡æ¡£
å¦‚æœä½ æƒ³æŸ¥çœ‹æœ€æ–°çš„æ–‡æ¡£ï¼Œè¯·è®¿é—® [eraft å®˜ç½‘](https://eraft.cn)

### ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼?

é¦–å…ˆæˆ‘ä»¬çœ‹ä¼ ç»Ÿçš„å•èŠ‚ç‚¹ C/S æˆ–è€… B/S ç³»ç»Ÿæœ‰å•¥ç¼ºç‚¹ï¼š
å•èŠ‚ç‚¹æ„å‘³ç€åªç”¨ä¸€å°æœºå™¨ï¼Œæœºå™¨çš„æ€§èƒ½æ˜¯æœ‰ä¸Šé™çš„ï¼Œè€Œä¸”æ€§èƒ½è¶Šå¥½çš„æœºå™¨ä»·æ ¼è¶Šè´µï¼Œæƒ³ IBM çš„å¤§å‹æœºï¼Œä»·æ ¼æ˜¯å¾ˆè´µçš„ã€‚åŒæ—¶ï¼Œè¿™å°æœºå™¨å¦‚æœæŒ‚æ‰æˆ–è€…å› ä¸ºå†™çš„ä»£ç æœ‰ bug å¯¼è‡´è¿›ç¨‹å¼‚å¸¸ï¼Œå°±æ— æ³•å®¹é”™ï¼Œç³»ç»Ÿç›´æ¥ä¸å¯ç”¨ã€‚

æˆ‘ä»¬åˆ†æå®Œå•èŠ‚ç‚¹ç³»ç»Ÿçš„ç¼ºç‚¹åï¼Œå¯ä»¥æ€»ç»“ä¸€ä¸‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„è®¾è®¡ç›®æ ‡

#### 1.å¯æ‰©å±•æ€§ï¼ˆScalabilityï¼‰
æˆ‘ä»¬è®¾è®¡çš„åˆ†å¸ƒå¼ç³»ç»Ÿè¦å…·æœ‰å¯æ‰©å±•æ€§ï¼Œè¿™é‡Œçš„å¯æ‰©å±•å…¶å®å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨æ›´å¤šçš„æœºå™¨æ¥è·å–æ›´é«˜çš„ç³»ç»Ÿæ€»ååä»¥åŠæ›´å¥½çš„æ€§èƒ½ï¼Œå½“ç„¶ä¹Ÿä¸æ˜¯æœºå™¨è¶Šå¤šæ€§èƒ½è¶Šå¥½ï¼Œé’ˆå¯¹ä¸€äº›å¤æ‚çš„è®¡ç®—åœºæ™¯ï¼ŒèŠ‚ç‚¹è¶Šå¤šæ€§èƒ½å¹¶ä¸ä¸€å®šä¼šæ›´å¥½ã€‚

#### 2.å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰
åˆ†å¸ƒå¼ç³»ç»Ÿä¸ä¼šå› ä¸ºç³»ç»Ÿä¸­çš„æŸå°æœºå™¨æ•…éšœè€Œç›´æ¥åœæ­¢æœåŠ¡ï¼ŒæŸå°æœºå™¨æ•…éšœåï¼Œç³»ç»Ÿå¯ä»¥å¿«é€Ÿåˆ‡æ¢æµé‡åˆ°æ­£å¸¸çš„æœºå™¨ä¸Šï¼Œç»§ç»­æä¾›æœåŠ¡ã€‚

#### 3.ä¸€è‡´æ€§ (Consistency)
æˆ‘ä»¬è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæœ€é‡è¦çš„ä¸€ä¸ªç®—æ³•å°±æ˜¯å¤åˆ¶ç®—æ³•ï¼ˆreplicationï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§å¤åˆ¶ç®—æ³•æ¥ä¿è¯æŒ‚æ‰çš„æœºå™¨å’Œåˆ‡ä¸Šå»é¡¶æ›¿å®ƒçš„æœºå™¨æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œé€šå¸¸åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸæœ‰ä¸“é—¨ä¸€è‡´æ€§ç®—æ³•å»ä¿è¯å¤åˆ¶çš„é¡ºåˆ©è¿›è¡Œã€‚


### ä¸€è‡´æ€§ç®—æ³•

å»ºè®®å…ˆçœ‹ [raft å°è®ºæ–‡](https://raft.github.io/raft.pdf)

å¸¦ç€ä¸‹é¢çš„é—®é¢˜å»çœ‹ï¼š

##### ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é—¹è£‚ï¼Ÿ

##### é¢å¯¹é—¹è£‚ï¼Œæˆ‘ä»¬çš„è§£å†³åŠæ³•æ˜¯ä»€ä¹ˆï¼Ÿ

##### ä¸ºä»€ä¹ˆå¤šæ•°æ´¾é€‰ä¸¾åè®®å¯ä»¥é¿å…è„‘è£‚ï¼Ÿ

##### ä¸ºä»€ä¹ˆ raft éœ€è¦ä½¿ç”¨æ—¥å¿—ï¼Ÿ

##### ä¸ºä»€ä¹ˆ raft åè®®ä¸­åªå…è®¸ä¸€ä¸ª leader?

##### æ€ä¹ˆä¿è¯åœ¨ä¸€ä¸ªä»»æœŸå†…åªæœ‰ä¸€ä¸ª leader çš„ï¼Ÿ

##### é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ€ä¹ˆçŸ¥é“ä¸€ä¸ªæ–°çš„ leader èŠ‚ç‚¹è¢«é€‰å‡ºäº†ï¼Ÿ

##### å¦‚æœé€‰ä¸¾å¤±è´¥äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

##### å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹éƒ½æ‹¿åˆ°äº†åŒæ ·çš„ç¥¨æ•°ï¼Œæ€ä¹ˆé€‰ leaderï¼Ÿ

##### å¦‚æœè€ä»»æœŸçš„ leader ä¸çŸ¥é“é›†ç¾¤ä¸­æ–° leader å‡ºç°äº†æ€ä¹ˆåŠï¼Ÿ

##### éšæœºçš„é€‰ä¸¾è¶…æ—¶æ—¶é—´ä½œç”¨ï¼Œå¦‚æœå»é€‰å–å®ƒçš„å€¼ï¼Ÿ

##### èŠ‚ç‚¹ä¸­çš„æ—¥å¿—ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°ä¸ä¸€è‡´ï¼ŸRaft æ€ä¹ˆå»ä¿è¯æœ€ç»ˆæ—¥å¿—ä¼šä¸€è‡´çš„ï¼Ÿ

##### ä¸ºä»€ä¹ˆä¸é€‰æ‹©æ—¥å¿—æœ€é•¿çš„æœåŠ¡å™¨ä½œä¸º leaderï¼Ÿ

##### åœ¨æœåŠ¡å™¨çªç„¶å´©æºƒçš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ

##### å¦‚æœ raft æœåŠ¡å¥”æºƒåé‡å¯äº†ï¼Œraft ä¼šè®°ä½å“ªäº›ä¸œè¥¿ï¼Ÿ

##### ä»€ä¹ˆæ˜¯ raft ç³»ç»Ÿä¸­å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆï¼Ÿ

##### åŸºäº raft çš„æœåŠ¡å´©æºƒé‡å¯åï¼Œæ˜¯å¦‚ä½•æ¢å¤çš„ï¼Ÿ

##### å“ªäº›æ—¥å¿—æ¡ç›® raft èŠ‚ç‚¹ä¸èƒ½åˆ é™¤ï¼Ÿ

##### raft æ—¥å¿—æ˜¯æ— é™åˆ¶å¢é•¿çš„å—ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆå¤§è§„æ¨¡çš„æ—¥å¿—æ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿ


å†çœ‹ [å¤§è®ºæ–‡](https://github.com/ongardie/dissertation) 


### æ•°æ®åˆ†ç‰‡

å¥½çš„ï¼Œé€šè¿‡ Raft åŸºæœ¬ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªé«˜å¯ç”¨çš„ raft æœåŠ¡å™¨ç»„ã€‚æˆ‘ä»¬å·²ç»è§£å†³äº†å‰é¢å¯ç”¨æ€§å’Œä¸€è‡´æ€§çš„é—®é¢˜ï¼Œä½†æ˜¯é—®é¢˜è¿˜æ˜¯å­˜åœ¨çš„ã€‚ä¸€ä¸ª raft æœåŠ¡å™¨ç»„ä¸­åªæœ‰ä¸€ä¸ª leader æ¥æ¥æ”¶è¯»å†™æµé‡ï¼Œå½“ç„¶ä½ å¯ä»¥ç”¨ follower åˆ†æ‹…éƒ¨åˆ†è¯»æµé‡æé«˜æ€§èƒ½ï¼ˆè¿™é‡Œä¼šæ¶‰åŠåˆ°äº‹åŠ¡çš„ä¸€äº›é—®é¢˜ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è®¨è®ºï¼‰ã€‚
ä½†æ˜¯ç³»ç»Ÿèƒ½æä¾›çš„èƒ½åŠ›è¿˜æ˜¯æœ‰ä¸Šé™çš„ã€‚

è¿™æ—¶å€™æˆ‘ä»¬å°±è¦æ€è€ƒï¼Œå°†å®¢æˆ·ç«¯å†™å…¥è¿‡æ¥çš„è¯·æ±‚è¿›è¡Œåˆ†ç‰‡å¤„ç†ï¼Œå°±åƒ  map reduceï¼Œmap çš„é˜¶æ®µä¸€ä¸‹ï¼Œå…ˆæŠŠè¶…å¤§çš„æ•°æ®é›†åˆ‡å‰²æˆä¸€ä¸ªä¸ªå°çš„å»å¤„ç†ã€‚

eraft ä¸­ä½¿ç”¨äº† hash åˆ†ç‰‡çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°†æ•°æ®é€šè¿‡å“ˆå¸Œç®—æ³•æ˜ å°„åˆ°ä¸€ä¸ªä¸ªæ¡¶ (bucket) é‡Œé¢ï¼Œç„¶åä¸åŒçš„ raft ç»„è´Ÿè´£ä¸€éƒ¨åˆ†æ¡¶ï¼Œä¸€ä¸ª raft ç»„å¯ä»¥è´Ÿè´£å¤šå°‘ä¸ªæ¡¶ï¼Œæ˜¯å¯ä»¥è°ƒæ•´çš„ã€‚


### é›†ç¾¤æ¶æ„

![é›†ç¾¤æ¶æ„](docs/imgs/eraftdb_arch.png)

é¦–å…ˆæˆ‘ä»¬å…ˆä»‹ç»ä¸‹æ¶æ„ä»‹ç»

#### æ¦‚å¿µä»‹ç»

##### bucket

å®ƒæ˜¯é›†ç¾¤åšæ•°æ®ç®¡ç†çš„é€»è¾‘å•å…ƒï¼Œä¸€ä¸ªåˆ†ç»„çš„æœåŠ¡å¯ä»¥è´Ÿè´£å¤šä¸ª bucket çš„æ•°æ®

##### config table

é›†ç¾¤é…ç½®è¡¨ï¼Œå®ƒä¸»è¦ç»´æŠ¤äº†é›†ç¾¤æœåŠ¡åˆ†ç»„ä¸ bucket çš„æ˜ å°„å…³ç³»ï¼Œå®¢æˆ·ç«¯è®¿é—®é›†ç¾¤æ•°æ®ä¹‹å‰éœ€è¦å…ˆåˆ°è¿™ä¸ªè¡¨æŸ¥è¯¢è¦è®¿é—® bucket æ‰€åœ¨çš„æœåŠ¡åˆ†ç»„åˆ—è¡¨

#### æœåŠ¡æ¨¡å—

##### configserver

å®ƒä¸»è¦è´Ÿè´£é›†ç¾¤é…ç½®è¡¨ç‰ˆæœ¬ç®¡ç†ï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªé›†ç¾¤é…ç½®è¡¨çš„ç‰ˆæœ¬é“¾ï¼Œå¯ä»¥è®°å½•é›†ç¾¤é…ç½®çš„å˜æ›´ã€‚

##### shardserver

å®ƒä¸»è¦è´Ÿè´£é›†ç¾¤æ•°æ®å­˜å‚¨ï¼Œä¸€èˆ¬æœ‰ä¸‰å°æœºå™¨ç»„æˆä¸€ä¸ª raft ç»„ï¼Œå¯¹å¤–æä¾›é«˜å¯ç”¨çš„æœåŠ¡ã€‚

### åœ¨ k8s ä¸­ä½“éªŒ eraft_kv

#### 1.å®‰è£… minikube 

[å®‰è£…æ–¹æ³•ç‚¹æˆ‘](https://minikube.sigs.k8s.io/docs/start/)

```
minikube start --image-mirror-country='cn'
```

è¾“å‡ºä¸€ä¸‹è¯´æ˜æˆåŠŸå¯åŠ¨ï¼š

```
colin@colindeMacBook-Pro ~ % minikube start --image-mirror-country='cn'
ğŸ˜„  Darwin 11.6 ä¸Šçš„ minikube v1.25.2
âœ¨  è‡ªåŠ¨é€‰æ‹© docker é©±åŠ¨
âœ…  æ­£åœ¨ä½¿ç”¨é•œåƒå­˜å‚¨åº“ registry.cn-hangzhou.aliyuncs.com/google_containers
ğŸ‘  Starting control plane node minikube in cluster minikube
ğŸšœ  Pulling base image ...
    > registry.cn-hangzhou.aliyun...: 379.06 MiB / 379.06 MiB  100.00% 5.77 MiB
ğŸ”¥  Creating docker container (CPUs=2, Memory=1986MB) ...
ğŸ³  æ­£åœ¨ Docker 20.10.12 ä¸­å‡†å¤‡ Kubernetes v1.23.3â€¦
    â–ª kubelet.housekeeping-interval=5m
    â–ª Generating certificates and keys ...
    â–ª Booting up control plane ...
    â–ª Configuring RBAC rules ...
ğŸ”  Verifying Kubernetes components...
    â–ª Using image registry.cn-hangzhou.aliyuncs.com/google_containers/storage-provisioner:v5
ğŸŒŸ  Enabled addons: storage-provisioner, default-storageclass
ğŸ„  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default
```

#### 2.éƒ¨ç½² eraft services

```
kubectl apply -f k8s/eraft-services.yaml
```

#### 3.éƒ¨ç½² StorageClass åŠ¨æ€å­˜å‚¨å·

```
kubectl apply -f k8s/eraft-storage-class.yaml
```

#### 4.éƒ¨ç½² kv_server åˆ†ç»„æœåŠ¡çš„ StatefulSet

```
kubectl apply -f k8s/eraft-statefulset.yaml
```

æˆåŠŸå¯åŠ¨ä¹‹å kubectl get pods å¯ä»¥çœ‹åˆ°é›†ç¾¤çš„çŠ¶æ€

```
colin@colindeMacBook-Pro eraft % kubectl get pods
NAME               READY   STATUS    RESTARTS   AGE
eraft-kvserver-0   1/1     Running   0          85s
eraft-kvserver-1   1/1     Running   0          82s
eraft-kvserver-2   1/1     Running   0          79s
```

#### 5.éªŒè¯å¯åŠ¨çŠ¶æ€

è¿˜å¯ä»¥é€šè¿‡ kubectl logs eraft-kvserver-0  1  2  æ¥æŸ¥çœ‹ Raft èŠ‚ç‚¹è¿è¡Œçš„æ—¥å¿—ä¿¡æ¯

```
kubectl logs eraft-kvserver-2 | less
```

åœ¨æˆ‘çš„æœºå™¨ä¸Š 2 å·èŠ‚ç‚¹è¢«æˆåŠŸçš„é€‰ä¸ºäº† Leader
```
2022-06-09 16:44:41 get last log with id -> 0 
2022-06-09 16:44:41 send request vote to eraft-kvserver-1.eraft-kvserver:8089 term:4 candidate_id:2
 
2022-06-09 16:44:41 send request vote to eraft-kvserver-0.eraft-kvserver:8088 term:4 candidate_id:2
 
2022-06-09 16:44:41 send request vote to eraft-kvserver-0.eraft-kvserver:8088 recive -> term:4 vote_granted:true, curterm 4, req term 4 
2022-06-09 16:44:41 I grant vote 
2022-06-09 16:44:41 node 2 get majority votes int term 4  
note change state to -> Leader 
2022-06-09 16:44:41 get last log with id -> 0 
2022-06-09 16:44:41 send heart beat to eraft-kvserver-0.eraft-kvserver:8088 
2022-06-09 16:44:41 send heart beat to eraft-kvserver-1.eraft-kvserver:8089 
2022-06-09 16:44:41 leader prevLogIndex 0 
2022-06-09 16:44:41 get first log with id -> 0 
2022-06-09 16:44:41 get first log with id -> 0 
2022-06-09 16:44:41 first log index 0 
2022-06-09 16:44:41 leader prevLogIndex 0 
2022-06-09 16:44:41 get first log with id -> 0 
2022-06-09 16:44:41 get first log with id -> 0 
```

#### 6.ä½¿ç”¨ kvcli æµ‹è¯•å†™å…¥

```
kubectl run eraft-client --image=eraft/eraft_stale_v1:v3 -i -t --rm --restart=Never -- kvcli eraft-kvserver-2.eraft-kvserver:8090 10
```

kubectl logs eraft-kvserver-2

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ“ä½œæˆåŠŸå†™å…¥ï¼Œæ—¥å¿—åŒæ­¥ä¹Ÿæ­£å¸¸

```
22-06-09 16:55:26 leader prevLogIndex 9
2022-06-09 16:55:26 get first log with id -> 5
2022-06-09 16:55:26 get first log with id -> 5
2022-06-09 16:55:26 first log index 5
2022-06-09 16:55:26 send heart beat to eraft-kvserver-1.eraft-kvserver:8089 success
2022-06-09 16:55:26 get last log with id -> 10
2022-06-09 16:55:26 get first log with id -> 5
2022-06-09 16:55:26 peer 2 advance commit index 9 at term 4
2022-06-09 16:55:26 peer id wait for replicating...
2022-06-09 16:55:26 get last log with id -> 10
2022-06-09 16:55:26 get first log with id -> 5
2022-06-09 16:55:26 send heart beat to eraft-kvserver-0.eraft-kvserver:8088 success
2022-06-09 16:55:26 peer id wait for replicating...
2022-06-09 16:55:26 get last log with id -> 10
2022-06-09 16:55:26 2, applies entries 9-10 in term 4
2022-06-09 16:55:26 applier ...
2022-06-09 16:55:26 del log with id 5 success
2022-06-09 16:55:26 del log with id 6 success
2022-06-09 16:55:26 del log with id 7 success
2022-06-09 16:55:26 del log with id 8 success
2022-06-09 16:55:26 del log with id 9 success
2022-06-09 16:55:26 del log entry before idx 10
2022-06-09 16:55:27 send heart beat to eraft-kvserver-0.eraft-kvserver:8088
2022-06-09 16:55:27 send heart beat to eraft-kvserver-1.eraft-kvserver:8089
2022-06-09 16:55:27 leader prevLogIndex 10
2022-06-09 16:55:27 leader prevLogIndex 10
2022-06-09 16:55:27 get first log with id -> 10
2022-06-09 16:55:27 get first log with id -> 10
2022-06-09 16:55:27 first log index 10
2022-06-09 16:55:27 get first log with id -> 10
2022-06-09 16:55:27 get first log with id -> 10
2022-06-09 16:55:27 first log index 10
2022-06-09 16:55:27 send heart beat to eraft-kvserver-1.eraft-kvserver:8089 success
2022-06-09 16:55:27 send heart beat to eraft-kvserver-0.eraft-kvserver:8088 success
```

### ä»æºç ç¼–è¯‘

å‡†å¤‡å·¥ä½œ

- go version >= go1.17.6
- å¼€å¯ go mod åŒ…ç®¡ç†æ¨¡å¼

**ä¸‹è½½ä»£ç ç¼–è¯‘**

```
git clone https://github.com/eraft-io/eraft.git

cd eraft
make
```

äº§å‡ºçš„ bin æ–‡ä»¶åœ¨ output ç›®å½•ä¸‹

### å¿«é€Ÿä¸Šæ‰‹ eraftï¼Œä½“éªŒåˆ†å¸ƒå¼ç³»ç»Ÿ

1.å¯åŠ¨ä¸€ç»„é…ç½®æœåŠ¡

```
# 8088 leader
./cfgserver 0 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090

# 8089
./cfgserver 1 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090

# 8090
./cfgserver 2 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090

```

2.æ·»åŠ ä¸€ä¸ªåˆå§‹åŒ–çš„é›†ç¾¤åˆ†ç»„

```
# join åˆå§‹çš„ server åˆ†ç»„ï¼Œè¿™é‡Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ä¸€å®šæ˜¯ 127.0.0.1:8088ï¼Œè¦å¯¹åº”å…·ä½“çš„é…ç½®æœåŠ¡ leader åœ°å€

./cfgcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 join 1 127.0.0.1:6088,127.0.0.1:6089,127.0.0.1:6090
./cfgcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 join 2 127.0.0.1:7088,127.0.0.1:7089,127.0.0.1:7090

```

3.å¯åŠ¨é›†ç¾¤åˆ†ç»„

```
./shardserver 0 1 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 127.0.0.1:6088,127.0.0.1:6089,127.0.0.1:6090

./shardserver 1 1 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 127.0.0.1:6088,127.0.0.1:6089,127.0.0.1:6090

./shardserver 2 1 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 127.0.0.1:6088,127.0.0.1:6089,127.0.0.1:6090
```

4.å†æ¬¡æ·»åŠ å¹¶å¯åŠ¨ä¸€ä¸ªåˆ†ç»„

```

// å†åŠ å…¥ä¸€ä¸ªåˆ†ç»„

./shardserver 0 2 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 127.0.0.1:7088,127.0.0.1:7089,127.0.0.1:7090

./shardserver 1 2 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 127.0.0.1:7088,127.0.0.1:7089,127.0.0.1:7090

./shardserver 2 2 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 127.0.0.1:7088,127.0.0.1:7089,127.0.0.1:7090
```

5.æŸ¥è¯¢åˆ†ç»„çŠ¶æ€
```
./cfgcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 query
```

6.è®¾ç½®æµé‡åˆ°åˆ†ç‰‡

```
./cfgcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 move 0-4 1

./cfgcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 move 5-9 2
```

7.è¯»å†™æ•°æ®
```
./shardcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 put testkey testvalue
./shardcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 get testkey
```

8.è¿è¡ŒåŸºå‡†æµ‹è¯•
```
./bench_cli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 100 put
```

æˆ‘ä»¬å›¢é˜Ÿè‡´åŠ›äºè§£è¯»å›½å¤–ä¼˜ç§€çš„åˆ†å¸ƒå¼å­˜å‚¨ç›¸å…³å¼€æºè¯¾ç¨‹ï¼Œæˆ‘ä»¬å§‹ç»ˆåšä¿¡ä¼˜ç§€çš„æœ¬ç§‘æ•™å­¦ä¸åº”è¯¥æ˜¯ç…§æœ¬å®£ç§‘ä»¥åŠåº”ä»˜è€ƒè¯•ï¼Œä¸€é—¨ä¼˜ç§€çš„è¯¾ç¨‹ï¼Œåº”è¯¥å…·å¤‡è®©å­¦ç”Ÿå­¦ä¼šæ€è€ƒã€åŠ¨æ‰‹å®è·µã€æ‰¾åˆ°é—®é¢˜ã€åå¤è¯•é”™ã€å¹¶è§£å†³é—®é¢˜çš„èƒ½åŠ›ï¼ŒåŒæ—¶åº”è¯¥å°½é‡ç”¨æœ€ç›´ç™½ï¼Œæœ€ç®€å•çš„è¯­è¨€ä¼ è¾¾å…³é”®çš„çŸ¥è¯†ç‚¹ã€‚ä½œä¸ºè®¡ç®—æœºå·¥ä¸šç•Œçš„å·¥ä½œè€…ï¼Œæˆ‘ç›¸ä¿¡åšè¯¾ç¨‹å’ŒåšæŠ€æœ¯ä¸€æ ·ï¼Œå¹¶ä¸æ˜¯è¶Šå¤æ‚è¶Šå¥½ï¼Œåº”è¯¥å°½é‡çš„è®©è®¾è®¡å‡ºæ¥çš„ä¸œè¥¿ç®€å•åŒ–ã€‚

https://www.zhihu.com/people/liu-jie-84-52

### å¦‚æœä½ æƒ³è¦æ‰¾åˆ°ä¹‹å‰ C++ ç‰ˆæœ¬ï¼Œè¯·è®¿é—®
[https://github.com/eraft-io/eraft/tree/eraft_with_rocksdb](https://github.com/eraft-io/eraft/tree/eraft_with_rocksdb)
